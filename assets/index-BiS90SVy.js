var d=Object.defineProperty;var p=(t,e,n)=>e in t?d(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var a=(t,e,n)=>p(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function g(t,e){const n=t.getScreenCTM();if(!n)throw new Error("Should has screen CTM.");const i=t.createSVGPoint();return i.x=e.x,i.y=e.y,i.matrixTransform(n.inverse())}function h(t){return t+8-8}function c(...t){let e=0;for(let n=1;n<t.length;n+=1){const i=t[n-1],r=t[n];e+=Math.sqrt(Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2))}return e}function w(t,e){const n=t.w/2;if(!e)return{left:{x:t.x,y:t.y+n},right:{x:t.x,y:t.y-n}};const i=Math.atan((t.y-e.y)/(t.x-e.x)),r=h(Math.sin(i)*n),s=h(Math.cos(i)*n);return{left:{x:t.x-r,y:t.y+s},right:{x:t.x+r,y:t.y-s}}}function m(...t){const e=["M"],n=[];for(let r=0;r<t.length;r+=1){const{left:s,right:o}=w(t[r],t[r-1]||t[r+1]),l=n.slice(r)[0];l&&c(l,s)>c(l,o)?n.splice(r,0,s,o):n.splice(r,0,o,s)}for(const r of n)e.push(`${r.x},${r.y}`);return{d:e.join(" ")}}function y(...t){const e=[];if(t.length===0)return[];e.push({...t[0]});for(let n=0;n<t.length-1;n++){const i=t[n],r=t[n+1];e.push({x:.75*i.x+.25*r.x,y:.75*i.y+.25*r.y,w:i.w*.75+r.w*.25},{x:.25*i.x+.75*r.x,y:.25*i.y+.75*r.y,w:i.w*.25+r.w*.75})}return t.length>2&&e.push({...t[t.length-1]}),e}function x(t,e=1){let n=t;for(let i=0;i<e;i+=1)n=y(...n);return n}class v{constructor(e){a(this,"el");a(this,"isDrawing",!1);a(this,"points",[]);a(this,"target");a(this,"width",20);a(this,"lastDrawTime");this.el=e}onPointerdown(e){e.preventDefault(),this.isDrawing=!0,this.points=[];const n=document.createElementNS("http://www.w3.org/2000/svg","path");this.el.appendChild(n),this.target=n}get mustTarget(){if(!this.target)throw new Error("Should has target");return this.target}onPointermove(e){if(!this.isDrawing||(e.preventDefault(),this.lastDrawTime&&Date.now()-this.lastDrawTime<4))return;this.lastDrawTime=Date.now();const{x:n,y:i}=g(this.el,e),r=e.pressure*this.width,s={x:n,y:i,w:r},o=this.points.slice(-1)[0];o&&c(o,s)<this.width||(this.points.push(s),e.pointerType==="mouse"&&(this.points=this.points.map((l,u,f)=>({...l,w:this.width*(u/f.length)}))),this.update())}onPointerup(e){e.preventDefault(),this.isDrawing=!1,delete this.target}install(){this.el.addEventListener("pointerdown",this.onPointerdown.bind(this)),this.el.addEventListener("pointermove",this.onPointermove.bind(this)),this.el.addEventListener("pointerup",this.onPointerup.bind(this))}update(){const{d:e}=m(...x(this.points,4));this.mustTarget.setAttribute("d",e)}}(()=>{const t=document.querySelector("svg#canvas");if(!(t instanceof SVGSVGElement))throw Error("Missing canvas element");new v(t).install(),t.addEventListener("pointermove",e=>{const n=document.querySelector("#pressure");n&&(n.textContent=e.pressure.toString())}),t.addEventListener("pointermove",e=>{const n=document.querySelector("#pointer-type");n&&(n.textContent=e.pointerType)})})();
